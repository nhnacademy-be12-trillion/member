<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>추가 정보 입력</title>
    <style>
        body { font-family: sans-serif; display: flex; justify-content: center; align-items: center; height: 100vh; background-color: #f0f2f5; }
        .container { background: white; padding: 2rem; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); width: 300px; }
        input { width: 100%; padding: 8px; margin: 8px 0; box-sizing: border-box; }
        button { width: 100%; padding: 10px; background-color: #007bff; color: white; border: none; border-radius: 4px; cursor: pointer; }
        button:hover { background-color: #0056b3; }
        h2 { text-align: center; color: #333; }
    </style>
</head>
<body>

<div class="container">
    <h2>회원가입 마무리</h2>
    <p>소셜 인증이 완료되었습니다.<br>서비스 이용을 위해 생년월일을 입력해주세요.</p>

    <label>이메일</label>
    <input type="text" id="email" readonly style="background-color: #e9ecef;">

    <label>이름</label>
    <input type="text" id="name" readonly style="background-color: #e9ecef;">

    <label>생년월일 (필수)</label>
    <input type="date" id="birthDate" required>

    <label>연락처 (필수)</label>
    <input type="text" id="contact" placeholder="010-0000-0000">

    <button onclick="submitSignup()">가입 완료</button>
</div>

<script>
    // 1. URL 파라미터에서 데이터 추출
    const urlParams = new URLSearchParams(window.location.search);
    const email = urlParams.get('email');
    const name = urlParams.get('name');
    const token = urlParams.get('token'); // Register Token

    // 2. 화면에 표시
    document.getElementById('email').value = email;
    document.getElementById('name').value = name;

    // 3. 가입 요청 함수
    function submitSignup() {
        const birthDate = document.getElementById('birthDate').value;
        const contact = document.getElementById('contact').value;

        if (!birthDate) {
            alert("생년월일은 필수입니다.");
            return;
        }
        if (!contact) {
            alert("전화번호는 필수입니다.")
            return;
        }

        const data = {
            email: email,
            name: name,
            birthDate: birthDate,
            contact: contact
        };

        // API 호출
        fetch('/api/members/signup/social', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify(data)
        })
            .then(response => {
                if (response.ok) {
                    alert("가입이 완료되었습니다!");
                    window.location.href = '/login.html';
                } else {
                    response.json().then(err => alert("가입 실패: " + err.message));
                }
            })
            .catch(error => {
                console.error('Error:', error);
                alert("서버 오류가 발생했습니다.");
            });
    }
</script>
</body>
</html>